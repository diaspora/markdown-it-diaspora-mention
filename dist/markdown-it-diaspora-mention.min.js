/*! markdown-it-diaspora-mention 0.2.1 https://github.com/diaspora/markdown-it-diaspora-mention @license MIT */
!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;"undefined"!=typeof window?n=window:"undefined"!=typeof global?n=global:"undefined"!=typeof self&&(n=self),n.markdownitDiasporaMention=e()}}(function(){return function e(n,t,r){function o(l,u){if(!t[l]){if(!n[l]){var f="function"==typeof require&&require;if(!u&&f)return f(l,!0);if(i)return i(l,!0);var c=new Error("Cannot find module '"+l+"'");throw c.code="MODULE_NOT_FOUND",c}var s=t[l]={exports:{}};n[l][0].call(s.exports,function(e){var t=n[l][1][e];return o(t?t:e)},s,s.exports,e,n,t,r)}return t[l].exports}for(var i="function"==typeof require&&require,l=0;l<r.length;l++)o(r[l]);return o}({1:[function(e,n){"use strict";function t(e,n){return'<a href="'+e[n].content+'" class="'+e[n].linkclass+'">'}function r(){return"</a>"}function o(e,n){return e[n].content}function i(e){return/^<a[>\s]/i.test(e)}function l(e){return/^<\/a\s*>/i.test(e)}n.exports=function(e,n){function u(e){var n;for(n=0;n<a.length;n++)if(e===a[n].diaspora_id||e===a[n].handle)return a[n];return null}function f(e){var n,t,r,o,f,a,y,h,v,m,x,g,_,w,k,b,q,E,O,U=e.tokens,D="@\\{([^;]+); ([^\\}]+)\\}";for(E=new RegExp(D),O=new RegExp(D,"g"),t=0,r=U.length;r>t;t++)if("inline"===U[t].type)for(a=U[t].children,y=0,n=a.length-1;n>=0;n--)if(f=a[n],"link_close"!==f.type){if("html_inline"===f.type&&(i(f.content)&&y>0&&y--,l(f.content)&&y++),!(y>0)&&"text"===f.type&&(k=f.content,h=k.match(O),null!==h)){for(b=[],q=f.level,o=0;o<h.length;o++)v=h[o].match(E),m=k.indexOf(h[o]),x=v[1],g=v[2],w="mention",m>0&&b.push({type:"text",content:k.slice(0,m),level:q}),_=u(g),_?(s&&_.guid!==c&&(w+=" hovercardable"),b.push({type:"mention_open",content:_.url||"/people/"+_.guid,linkclass:w,level:q++}),b.push({type:"mention_text",content:d(x).trim(),level:q}),b.push({type:"mention_close",content:g,level:--q})):b.push({type:"text",content:x,level:q}),k=k.slice(m+v[0].length);k.length>0&&b.push({type:"text",content:k,level:e.level}),a=p(a,n,b),U[t].children=a}}else for(n--;a[n].level!==f.level&&"link_open"!==a[n].type;)n--}var c,s,p=e.utils.arrayReplaceAt,d=e.utils.escapeHtml,a=[];"undefined"!=typeof n.mentions&&(a=n.mentions),"undefined"!=typeof n.currentUserId&&(c=n.currentUserId),"undefined"!=typeof n.allowHovercards&&(s=n.allowHovercards),e.core.ruler.after("inline","mention",f),e.renderer.rules.mention_open=t,e.renderer.rules.mention_text=o,e.renderer.rules.mention_close=r}},{}]},{},[1])(1)});